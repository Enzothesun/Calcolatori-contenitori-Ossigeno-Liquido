<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calcolatore Autonomia – LED 8</title>

  <style>
    :root{
      --bg:#f2f6fb;
      --card:#ffffff;
      --text:#0b253a;
      --muted:#6b7a8c;
      --line:#e7edf5;
      --shadow:0 10px 28px rgba(0,0,0,.08);
      --radius:18px;
      --accent:#009A7E;
      --accent2:#CFF8EE;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 28px 14px;
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
    }
    h1{
      margin: 0 0 6px;
      text-align:center;
      font-size: 28px;
      letter-spacing:.2px;
    }
    .subtitle{
      text-align:center;
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 18px;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .topGrid{
      display:grid;
      grid-template-columns: 1.3fr 1fr 1fr;
      gap: 14px;
      align-items: start;
    }
    @media (max-width: 880px){
      .topGrid{grid-template-columns: 1fr}
    }
    .label{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    /* LED bar */
    .ledBar{
      display:flex;
      gap:6px;
      align-items:center;
      flex-wrap:wrap;
    }
    .ledDot{
      width: 18px;
      height: 10px;
      border-radius: 999px;
      background: #d8e4f2;
      border: 1px solid #cfe0f4;
      position: relative;
      cursor:pointer;
      transition: transform .12s ease;
    }
    .ledDot:hover{ transform: translateY(-1px); }
    .ledDot[data-zone="red"]{ background: #f5b6b6; border-color:#f0a0a0; }
    .ledDot[data-zone="yellow"]{ background:#ffe3a4; border-color:#ffd985; }
    .ledDot[data-zone="green"]{ background:#b8f2df; border-color:#9eead3; }
    .ledDot.active{
      outline: 3px solid rgba(0,154,126,.25);
    }
    .ledNums{
      display:flex;
      gap:10px;
      margin-top: 6px;
      color: var(--muted);
      font-size: 11px;
      padding-left: 2px;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      background: #f6fbff;
      border: 1px solid var(--line);
      font-size: 12px;
      color: var(--text);
      margin-top: 10px;
      width: fit-content;
    }
    .pill b{ font-size: 13px; }

    /* Inputs */
    .field{
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: #fbfdff;
    }
    .field input{
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      font-size: 14px;
      color: var(--text);
    }
    .btnMini{
      width: 34px;
      height: 34px;
      border: none;
      border-radius: 10px;
      cursor:pointer;
      background: rgba(0,0,0,.06);
      font-weight: 800;
    }
    .btnMini:hover{ background: rgba(0,0,0,.10); }

    /* Therapy block */
    .therapyGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 880px){
      .therapyGrid{grid-template-columns: 1fr}
    }
    .therapyTitle{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 10px;
      margin: 10px 0 8px;
    }
    .therapyTitle h3{
      margin:0;
      font-size: 14px;
    }
    .hint{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 12px;
    }
    .divider{
      height: 1px;
      background: var(--line);
      margin: 14px 0;
    }

    /* Results */
    .results{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 880px){
      .results{grid-template-columns: 1fr}
    }
    .resBox{
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 14px;
      background: #fbfdff;
      min-height: 92px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      text-align:center;
    }
    .resLabel{
      font-size: 11px;
      color: var(--muted);
      letter-spacing:.3px;
      text-transform: uppercase;
      margin-bottom: 6px;
    }
    .resValue{
      font-size: 28px;
      font-weight: 800;
      line-height: 1;
    }
    .unit{
      font-size: 12px;
      color: var(--muted);
      margin-left: 6px;
      font-weight: 600;
    }

    .foot{
      margin-top: 12px;
      font-size: 11px;
      color: var(--muted);
      text-align:left;
      line-height: 1.35;
    }

    .barNote{
      text-align:center;
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Calcolatore Autonomia – LED 8</h1>
    <div class="subtitle">Stima prudenziale: si considera sempre <b>–1 LED</b> rispetto a quello osservato</div>

    <div class="card">

      <div class="topGrid">

        <!-- LED -->
        <div>
          <div class="label"><b>LED acceso (osservato)</b> [1–8]</div>

          <div class="ledBar" id="ledBar" aria-label="Selezione LED">
            <!-- 1 rosso, 2-3 giallo, 4-8 verde -->
          </div>
          <div class="ledNums" aria-hidden="true">
            <span style="width:18px;text-align:center;">1</span>
            <span style="width:18px;text-align:center;">2</span>
            <span style="width:18px;text-align:center;">3</span>
            <span style="width:18px;text-align:center;">4</span>
            <span style="width:18px;text-align:center;">5</span>
            <span style="width:18px;text-align:center;">6</span>
            <span style="width:18px;text-align:center;">7</span>
            <span style="width:18px;text-align:center;">8</span>
          </div>

          <div class="pill"><span>LED osservato:</span> <b id="ledObs">6</b></div>
          <div class="pill"><span>LED per calcolo:</span> <b id="ledCalc">5</b></div>

          <div class="barNote">Colori: 1 rosso • 2–3 giallo • 4–8 verde</div>
        </div>

        <!-- Terapia 1 -->
        <div>
          <div class="therapyTitle">
            <h3>Terapia 1 (obbligatoria)</h3>
          </div>

          <div class="label">Flusso (L/min)</div>
          <div class="field">
            <button class="btnMini" type="button" onclick="stepNum('flow1', -0.5)">−</button>
            <input id="flow1" type="number" min="0" step="0.5" value="2" />
            <button class="btnMini" type="button" onclick="stepNum('flow1', 0.5)">+</button>
          </div>

          <div class="label" style="margin-top:10px;">Ore di terapia al giorno</div>
          <div class="field">
            <button class="btnMini" type="button" onclick="stepNum('hours1', -1)">−</button>
            <input id="hours1" type="number" min="0" max="24" step="1" value="24" />
            <button class="btnMini" type="button" onclick="stepNum('hours1', 1)">+</button>
          </div>
        </div>

        <!-- Terapia 2 -->
        <div>
          <div class="therapyTitle">
            <h3>Terapia 2 (opzionale)</h3>
          </div>

          <div class="label">Flusso (L/min)</div>
          <div class="field">
            <button class="btnMini" type="button" onclick="stepNum('flow2', -0.5)">−</button>
            <input id="flow2" type="number" min="0" step="0.5" value="0" />
            <button class="btnMini" type="button" onclick="stepNum('flow2', 0.5)">+</button>
          </div>

          <div class="label" style="margin-top:10px;">Ore di terapia al giorno</div>
          <div class="field">
            <button class="btnMini" type="button" onclick="stepNum('hours2', -1)">−</button>
            <input id="hours2" type="number" min="0" max="24" step="1" value="0" />
            <button class="btnMini" type="button" onclick="stepNum('hours2', 1)">+</button>
          </div>

          <div class="hint">Compilare solo se il paziente utilizza flussi diversi nella giornata.</div>
        </div>

      </div>

      <div class="divider"></div>

      <div class="results">
        <div class="resBox">
          <div class="resLabel">Litri residui (stima prudenziale)</div>
          <div class="resValue"><span id="litriResidui">16.560</span><span class="unit">L</span></div>
        </div>

        <div class="resBox">
          <div class="resLabel">Autonomia (ore)</div>
          <div class="resValue"><span id="autonomiaOre">138</span></div>
        </div>

        <div class="resBox">
          <div class="resLabel">Autonomia (giorni)</div>
          <div class="resValue"><span id="autonomiaGiorni">5,8</span></div>
        </div>

        <div class="resBox">
          <div class="resLabel">Consumo/giorno</div>
          <div class="resValue"><span id="consumoGiorno">2880</span><span class="unit">L</span></div>
        </div>
      </div>

      <div class="foot">
        <div><b>Nota:</b> l’autonomia si basa sul <b>consumo complessivo giornaliero</b> (Terapia 1 + eventuale Terapia 2).</div>
        <div style="margin-top:6px;">
          <b>Config da validare/agganciare:</b> capacità totale e litri per LED devono essere gli stessi del calcolatore ufficiale già in uso.
        </div>
        <div style="margin-top:6px; opacity:.9;">© Calcolatore autonomia – uso informativo</div>
      </div>

    </div>
  </div>

<script>
  /***********************
   * CONFIG (DA SETTARE)
   ***********************
   * Qui mettiamo i numeri "ufficiali" appena me li confermi.
   * Per ora uso valori di esempio COERENTI con lo screenshot:
   * - capacità totale 26.500 L
   * - 8 LED -> 3.312,5 L per LED (approssimato)
   */
  const CONFIG = {
    totalLiters: 26500,
    ledsTotal: 8,
    litersPerLed: 26500 / 8,   // 3312.5
    prudentialMinusLed: 1
  };

  // Stato
  let ledObserved = 6;

  // Build LED bar
  const ledBar = document.getElementById('ledBar');
  function ledZone(i){
    if (i === 1) return 'red';
    if (i === 2 || i === 3) return 'yellow';
    return 'green'; // 4-8
  }

  function renderLedBar(){
    ledBar.innerHTML = '';
    for (let i=1; i<=CONFIG.ledsTotal; i++){
      const dot = document.createElement('div');
      dot.className = 'ledDot' + (i === ledObserved ? ' active' : '');
      dot.dataset.led = i;
      dot.dataset.zone = ledZone(i);
      dot.title = `LED ${i}`;
      dot.onclick = () => {
        ledObserved = i;
        renderLedBar();
        updateAll();
      };
      ledBar.appendChild(dot);
    }
  }

  function clamp(n, min, max){
    return Math.max(min, Math.min(max, n));
  }

  function getLedCalc(){
    // prudenziale: almeno 1
    return clamp(ledObserved - CONFIG.prudentialMinusLed, 1, CONFIG.ledsTotal);
  }

  function litersResidual(){
    return getLedCalc() * CONFIG.litersPerLed;
  }

  function dailyConsumptionLiters(){
    const f1 = parseFloat(document.getElementById('flow1').value || '0');
    const h1 = parseFloat(document.getElementById('hours1').value || '0');
    const f2 = parseFloat(document.getElementById('flow2').value || '0');
    const h2 = parseFloat(document.getElementById('hours2').value || '0');

    // L/min * ore * 60 = L/giorno
    const c1 = f1 * h1 * 60;
    const c2 = f2 * h2 * 60;

    return Math.max(0, c1 + c2);
  }

  function formatIt(n, decimals=0){
    const opts = { minimumFractionDigits: decimals, maximumFractionDigits: decimals };
    return n.toLocaleString('it-IT', opts);
  }

  function updateAll(){
    const ledCalc = getLedCalc();
    document.getElementById('ledObs').textContent = ledObserved;
    document.getElementById('ledCalc').textContent = ledCalc;

    const residui = litersResidual();
    const consumo = dailyConsumptionLiters();

    document.getElementById('litriResidui').textContent = formatIt(residui, 0);

    document.getElementById('consumoGiorno').textContent = formatIt(consumo, 0);

    let ore = 0;
    let giorni = 0;

    if (consumo > 0){
      giorni = residui / consumo;
      ore = giorni * 24;
    }

    // ore intere, giorni 1 decimale
    document.getElementById('autonomiaOre').textContent = formatIt(ore, 0);
    document.getElementById('autonomiaGiorni').textContent = formatIt(giorni, 1);
  }

  // step buttons
  function stepNum(id, delta){
    const el = document.getElementById(id);
    let v = parseFloat(el.value || '0');
    v = isNaN(v) ? 0 : v;
    v += delta;

    // clamp ore 0-24
    if (id.startsWith('hours')) v = clamp(v, 0, 24);
    if (id.startsWith('flow')) v = clamp(v, 0, 50);

    // fix float .5
    el.value = (Math.round(v*2)/2).toString();
    updateAll();
  }

  // listeners
  ['flow1','hours1','flow2','hours2'].forEach(id=>{
    const el = document.getElementById(id);
    el.addEventListener('input', updateAll);
    el.addEventListener('change', updateAll);
  });

  // init
  renderLedBar();
  updateAll();
</script>

</body>
</html>
