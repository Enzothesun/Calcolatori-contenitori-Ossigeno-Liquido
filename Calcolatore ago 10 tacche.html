
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calcolatore Autonomia (ago, 10 tacche)</title>
<style>
  :root{--bg:#f5f7fb;--card:#fff;--border:#e5e7eb;--text:#0f172a;--muted:#64748b;--pill:#f8fafc;--green:#22c55e;--yellow:#f59e0b;--red:#ef4444}
  body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1100px;margin:24px auto 48px;padding:0 18px}
  h1{margin:0 0 10px;font-size:26px;font-weight:800}
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 8px 26px rgba(15,23,42,.06)}
  .grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .sec{font-size:12px;text-transform:uppercase;color:var(--muted);margin:4px 0 12px}
  .g{display:flex;justify-content:center}
  .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
  .kpi{background:var(--pill);border-radius:12px;padding:12px}
  .kpi .label{font-size:12px;color:var(--muted);text-transform:uppercase}
  .kpi .val{font-size:26px;font-weight:800;margin-top:6px}
  .controls{background:var(--pill);border-radius:12px;padding:12px}
  .row{display:flex;gap:10px;align-items:center;margin-top:6px}
  input[type=number]{width:140px;padding:10px;border:1px solid var(--border);border-radius:10px;font-size:16px}
  .slider{width:100%;margin-top:10px}
  .note{margin-top:12px;display:none;background:#FEF3C7;color:#92400E;border:1px solid #FDE68A;padding:10px;border-radius:10px;font-size:14px}
  .tick{stroke:#cbd5e1;stroke-width:2}
  .lbl{fill:#334155;font-size:12px;font-weight:600}
</style>
</head>
<body>
<div class="wrap">
  <h1>Calcolatore Autonomia (ago, 10 tacche)</h1>

  <div class="card">
    <div class="grid">
      <div>
        <div class="sec">Quadrante (OUT = 0 → FULL = 10)</div>
        <div class="g">
          <svg id="gauge" viewBox="0 0 600 340" width="600" height="340">
            <!-- base arc (semicerchio) -->
            <path id="base" fill="none" stroke="#e2e8f0" stroke-width="28" stroke-linecap="butt"/>
            <!-- zones -->
            <g id="zones"></g>
            <!-- ticks and labels -->
            <g id="ticks"></g>
            <!-- OUT / FULL -->
            <text x="90"  y="300" fill="#ef4444" font-size="12" font-weight="700" text-anchor="start">OUT</text>
            <text x="510" y="300" fill="#16a34a" font-size="12" font-weight="700" text-anchor="end">FULL</text>
            <!-- needle -->
            <g id="needle">
              <circle cx="300" cy="300" r="8" fill="#0ea5e9" stroke="#bae6fd" stroke-width="2"/>
              <line id="needleLine" x1="300" y1="300" x2="300" y2="140" stroke="#0f172a" stroke-width="6" stroke-linecap="round"/>
            </g>
          </svg>
        </div>
        <input id="levelRange" class="slider" type="range" min="0" max="10" step="1" value="0">
        <div style="color:#64748b;font-size:12px;margin-top:10px">Scala lineare: 0 → 0 L · 10 → 26 500 L (≈ 2 650 L per tacca). Colori: 0–1 rosso · 1–3 giallo · 3–10 verde.</div>
      </div>

      <div>
        <div class="sec">Impostazioni</div>
        <div class="controls">
          <div>Livello (0..10)</div>
          <div class="row"><input id="levelNum" type="number" min="0" max="10" step="1" value="0"></div>
          <div style="margin-top:8px;">Flusso (L/min)</div>
          <div class="row"><input id="flow" type="number" step="0.1" value="2"><span style="color:#64748b">L/min</span></div>
          <div style="margin-top:8px;">Ore di terapia/giorno</div>
          <div class="row"><input id="hday" type="number" step="1" min="1" max="24" value="24"><span style="color:#64748b">ore/giorno</span></div>
        </div>
        <div class="kpis">
          <div class="kpi"><div class="label">Litri residui</div><div class="val" id="kpi-litri">0 L</div></div>
          <div class="kpi"><div class="label">Autonomia (ore)</div><div class="val" id="kpi-ore">0 h</div></div>
          <div class="kpi"><div class="label">Autonomia (giorni)</div><div class="val" id="kpi-giorni">0 gg</div></div>
        </div>
        <div id="warn" class="note" style="display:block">⚠️ Con livello <b>0 o 1</b> il contenitore è da considerarsi <b>finito</b> (restano circa <b>2 650 – 3 000 L</b>).</div>
      </div>
    </div>
  </div>
</div>

<script>
const fmtInt = n => new Intl.NumberFormat('it-IT').format(Math.round(n));
const fmt1   = n => (Math.round(n*10)/10).toLocaleString('it-IT');

(function buildGauge(){
  const svg   = document.getElementById('gauge');
  const base  = svg.querySelector('#base');
  const zones = svg.querySelector('#zones');
  const ticks = svg.querySelector('#ticks');
  const cx=300, cy=300, R=250;   // base center/radius
  const SW=28;
  const toRad = d => d*Math.PI/180;
  const angleFromLevel = lv => 180*(1 - lv/10); // 0->180 (sx), 10->0 (dx)

  // Arc path that respects the provided direction (no sorting), sweep=1 (clockwise along the top).
  function arcPathExact(a0,a1){
    const x0=cx + R*Math.cos(toRad(a0)), y0=cy - R*Math.sin(toRad(a0));
    const x1=cx + R*Math.cos(toRad(a1)), y1=cy - R*Math.sin(toRad(a1));
    const large = (Math.abs(a1-a0)>180) ? 1 : 0;
    return `M ${x0} ${y0} A ${R} ${R} 0 ${large} 1 ${x1} ${y1}`;
  }

  // Base arc: left(180) -> right(0), clockwise along the top.
  base.setAttribute('d', arcPathExact(180,0));
  base.setAttribute('stroke-width', SW);

  // Colored zones EXACT overlay, drawn *left -> right* (capovolti rispetto a prima)
  function addZoneLevels(l0,l1,color){
    const a0 = angleFromLevel(l0); // 180 at 0
    const a1 = angleFromLevel(l1); // smaller angle to the right
    const p = document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d', arcPathExact(a0,a1));
    p.setAttribute('fill','none');
    p.setAttribute('stroke', color);
    p.setAttribute('stroke-width', SW);
    p.setAttribute('stroke-linecap','butt');
    zones.appendChild(p);
  }
  // 0–1 rosso, 1–3 giallo, 3–10 verde
  addZoneLevels(0,1,'#ef4444');
  addZoneLevels(1,3,'#f59e0b');
  addZoneLevels(3,10,'#22c55e');

  // Ticks + labels 0..10 (unchanged)
  for(let lv=0; lv<=10; lv++){
    const a = angleFromLevel(lv);
    const x1=cx + R*Math.cos(toRad(a)),     y1=cy - R*Math.sin(toRad(a));
    const x2=cx + (R-24)*Math.cos(toRad(a)), y2=cy - (R-24)*Math.sin(toRad(a));
    const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
    ln.setAttribute('x1',x1); ln.setAttribute('y1',y1); ln.setAttribute('x2',x2); ln.setAttribute('y2',y2);
    ln.setAttribute('class','tick'); ticks.appendChild(ln);
    const tx=cx + (R-42)*Math.cos(toRad(a)), ty=cy - (R-42)*Math.sin(toRad(a));
    const t=document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x',tx); t.setAttribute('y',ty);
    t.setAttribute('text-anchor','middle'); t.setAttribute('alignment-baseline','middle');
    t.setAttribute('class','lbl'); t.textContent=String(lv); ticks.appendChild(t);
  }

  // expose mapping for needle
  window._gauge = {cx,cy,R,angleFromLevel};
})();

const levelRange = document.getElementById('levelRange');
const levelNum   = document.getElementById('levelNum');
const flowEl = document.getElementById('flow');
const hdayEl = document.getElementById('hday');
const litriEl = document.getElementById('kpi-litri');
const oreEl   = document.getElementById('kpi-ore');
const giorniEl= document.getElementById('kpi-giorni');
const needleL = document.getElementById('needleLine');
const warn    = document.getElementById('warn');

function recompute(source){
  let lvl = source==='range' ? Number(levelRange.value) : Number(levelNum.value);
  if (!isFinite(lvl)) lvl = 0;
  lvl = Math.max(0, Math.min(10, Math.round(lvl)));
  levelRange.value = lvl; levelNum.value = lvl;

  const liters = 2650 * lvl;
  const flow = Math.max(0, Number(String(flowEl.value).replace(',','.')) || 0);
  const hday = Math.max(1, Math.round(Number(String(hdayEl.value).replace(',','.')) || 24));
  const hours = flow>0 ? (liters/(flow*60)) : 0;
  const days  = hours / hday;
  litriEl.textContent = fmtInt(liters)+' L';
  oreEl.textContent   = fmt1(hours)+' h';
  giorniEl.textContent= fmt1(days)+' gg';

  const {cx,cy,R,angleFromLevel} = window._gauge;
  const a = angleFromLevel(lvl);
  const x = cx + (R-110)*Math.cos(a*Math.PI/180);
  const y = cy - (R-110)*Math.sin(a*Math.PI/180);
  needleL.setAttribute('x2', x);
  needleL.setAttribute('y2', y);

  warn.style.display = (lvl<=1) ? 'block' : 'none';
}

// bind
levelRange.addEventListener('input', ()=>recompute('range'));
levelNum  .addEventListener('input', ()=>recompute('num'));
flowEl    .addEventListener('input', recompute);
hdayEl    .addEventListener('input', recompute);

// init
recompute('range');
</script>
</body>
</html>
